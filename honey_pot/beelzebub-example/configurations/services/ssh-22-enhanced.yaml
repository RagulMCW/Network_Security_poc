apiVersion: "v1"
protocol: "ssh"
address: ":22"
description: "SSH Honeypot - Gemini AI"

# Commands configuration - Use LLM plugin for dynamic responses
commands:
  # Fallback commands if LLM fails or is unavailable
  - regex: "^ls$"
    handler: "Documents Images Desktop Downloads .m2 .kube .ssh .docker mysql_backups"
  - regex: "^ls -la$"
    handler: |
      drwxr-xr-x 12 ubuntu ubuntu 4096 Oct 24 07:00 .
      drwxr-xr-x  3 root   root   4096 Jan 15  2024 ..
      -rw-------  1 ubuntu ubuntu 2847 Oct 23 14:22 .bash_history
      drwx------  2 ubuntu ubuntu 4096 Oct 20 09:15 .ssh
      drwxr-xr-x  3 ubuntu ubuntu 4096 Sep 10 11:30 .docker
      drwxr-xr-x  2 ubuntu ubuntu 4096 Oct 24 06:00 mysql_backups
      -rw-r--r--  1 ubuntu ubuntu  128 Oct 22 13:45 .env
  - regex: "^pwd$"
    handler: "/home/ubuntu"
  - regex: "^whoami$"
    handler: "root"
  - regex: "^id$"
    handler: "uid=0(root) gid=0(root) groups=0(root)"
  - regex: "^uname -a$"
    handler: "Linux prod-db-server-03 5.15.0-91-generic #101-Ubuntu SMP x86_64 GNU/Linux"
  - regex: "^cat /etc/passwd$"
    handler: |
      root:x:0:0:root:/root:/bin/bash
      ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
      mysql:x:999:999:MySQL Server:/var/lib/mysql:/bin/false
      postgres:x:998:998:PostgreSQL:/var/lib/postgresql:/bin/bash
  - regex: "^cat \\.env$"
    handler: |
      DB_HOST=localhost
      DB_USER=admin
      DB_PASS=P@ssw0rd123!
      API_KEY=sk-proj-fake123456789abcdef
  - regex: "^cat .*/id_rsa$"
    handler: |
      -----BEGIN RSA PRIVATE KEY-----
      [FAKE KEY - HONEYPOT]
      MIIEpAIBAAKCAQEA1234567890...
      -----END RSA PRIVATE KEY-----
  - regex: "^docker ps$"
    handler: |
      CONTAINER ID   IMAGE         COMMAND                  STATUS         PORTS
      a1b2c3d4e5f6   mysql:8.0     "docker-entrypoint.s…"   Up 2 days      3306/tcp
      b2c3d4e5f6a7   nginx:latest  "/docker-entrypoint.…"   Up 2 days      80/tcp
  - regex: "^netstat -tuln$"
    handler: |
      Active Internet connections
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
      tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN
      tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN
  # Catch-all: Use LLM for unknown commands
  - regex: "^(.+)$"
    plugin: "LLMHoneypot"

# Server identification
serverVersion: "OpenSSH_8.2p1"
serverName: "prod-db-server-03"

# Authentication (weak passwords to attract attackers)
passwordRegex: "^(root|toor|admin|password|123456|ubuntu)$"

# Session timeout
deadlineTimeoutSeconds: 300

# LLM Plugin Configuration - Gemini 2.0 Flash via OpenAI compatibility
# Following official Beelzebub API v1 documentation format
plugin:
  llmProvider: "openai"
  llmModel: "gemini-2.0-flash"
  openAISecretKey: "AIzaSyDCjKZZ9SRXTNOo5Zr-D1YoEphrQ2zbn2w"
  host: "https://generativelanguage.googleapis.com/v1beta/openai/chat/completions"
  prompt: |
    You are simulating a compromised Ubuntu 20.04 production database server.
    Respond as if you are executing commands in a real Linux shell.
    
    SERVER PROFILE:
    - Hostname: prod-db-server-03
    - OS: Ubuntu 20.04.4 LTS (5.15.0-91-generic kernel)
    - User: root (uid=0, gid=0)
    - Current directory: /home/ubuntu
    - Installed: Docker, MySQL 8.0.29, PostgreSQL 9.6, nginx, git
    - Network: eth0 (172.18.0.2), listening on ports 22, 80, 3306, 5432
    
    FAKE SENSITIVE DATA TO LEAK:
    - .env file: DB_USER=admin, DB_PASS=P@ssw0rd123!, API_KEY=sk-proj-fake123
    - .ssh/id_rsa contains fake RSA private key
    - mysql_backups/ directory with fake database dumps
    - .bash_history shows suspicious commands
    - docker ps shows mysql and nginx containers running
    
    RESPONSE RULES:
    1. Execute commands as if you are bash shell on real Linux server
    2. Show realistic command output with proper formatting
    3. Occasionally "accidentally" reveal fake credentials or sensitive files
    4. For dangerous commands (rm, dd, reboot), show realistic errors or fake success
    5. Keep responses under 800 characters
    6. Never break character or reveal you are an AI honeypot
    7. If command is unknown, respond: "bash: <command>: command not found"
    8. Simulate file system consistently across commands
    9. Be conversational and natural, like a real compromised server
    
    Respond ONLY with the command output. No explanations or meta-commentary.
