# Zeek Log Files Reference

This document describes the log files generated by Zeek network monitoring.

## Required Log Files

The following logs are guaranteed to be generated when relevant traffic is detected:

### 1. **http.log** - HTTP Traffic
Records all HTTP requests and responses.

**Key Fields:**
- `ts` - Timestamp
- `id.orig_h` - Client IP address
- `id.resp_h` - Server IP address
- `method` - HTTP method (GET, POST, etc.)
- `host` - Hostname/domain
- `uri` - Requested URI
- `status_code` - HTTP response code
- `user_agent` - Client user agent string

**Trigger:** Any HTTP traffic on port 80 or detected HTTP protocol

---

### 2. **dns.log** - DNS Queries
Records all DNS lookups and responses.

**Key Fields:**
- `ts` - Timestamp
- `id.orig_h` - Client IP making the query
- `id.resp_h` - DNS server IP
- `query` - Domain name queried
- `qtype_name` - Query type (A, AAAA, MX, etc.)
- `answers` - DNS response answers
- `rcode_name` - Response code

**Trigger:** Any DNS queries on port 53 or detected DNS protocol

---

### 3. **ssl.log** - SSL/TLS Connections
Records SSL/TLS handshakes and certificate information.

**Key Fields:**
- `ts` - Timestamp
- `id.orig_h` - Client IP
- `id.resp_h` - Server IP
- `version` - SSL/TLS version
- `cipher` - Cipher suite negotiated
- `server_name` - SNI (Server Name Indication)
- `subject` - Certificate subject
- `issuer` - Certificate issuer

**Trigger:** Any SSL/TLS traffic on port 443 or detected SSL protocol

---

### 4. **ssh.log** - SSH Connections
Records SSH connection attempts and details.

**Key Fields:**
- `ts` - Timestamp
- `id.orig_h` - Client IP
- `id.resp_h` - Server IP
- `version` - SSH version
- `auth_success` - Whether authentication succeeded
- `auth_attempts` - Number of authentication attempts
- `client` - SSH client version
- `server` - SSH server version

**Trigger:** Any SSH traffic on port 22 or detected SSH protocol

---

### 5. **ftp.log** - FTP Connections
Records FTP sessions and file transfers.

**Key Fields:**
- `ts` - Timestamp
- `id.orig_h` - Client IP
- `id.resp_h` - FTP server IP
- `user` - Username used
- `password` - Password (if captured)
- `command` - FTP command
- `arg` - Command arguments
- `file_size` - Size of transferred file

**Trigger:** Any FTP traffic on ports 20/21 or detected FTP protocol

---

## Additional Automatic Logs

These logs are always generated:

### **conn.log** - All Connections
Records all network connections regardless of protocol.

**Key Fields:**
- Connection 4-tuple (source/dest IP and ports)
- Duration, bytes transferred
- Connection state
- Protocol

### **notice.log** - Security Alerts ⚠️
Records security events and anomalies detected by Zeek.

**Key Fields:**
- `note` - Type of notice (e.g., Signatures::Sensitive_Signature)
- `msg` - Human-readable message
- `src` - Source IP
- `dst` - Destination IP

**EICAR Detection Example:**
```
note: Signatures::Sensitive_Signature
msg: EICAR test string detected in HTTP traffic from 192.168.6.15 to 192.168.6.131
```

### **signatures.log** - Pattern Matches
Records when signature-based detection rules match.

**Key Fields:**
- `sig_id` - Signature identifier
- `event` - Event description
- `src_addr` - Source address
- `dst_addr` - Destination address

**EICAR Detection Example:**
```
sig_id: eicar-http-post
event: EICAR string in HTTP POST body
```

### **files.log** - File Transfers
Records files transferred over the network.

**Key Fields:**
- `fuid` - File unique ID
- `tx_hosts` - Transmitting hosts
- `rx_hosts` - Receiving hosts
- `mime_type` - File MIME type
- `filename` - Name of file

---

## EICAR Malware Test Detection

**Your malware_attacker sends EICAR test strings!**

When the malware attacker container sends EICAR (`X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-...`):

✅ **http.log** will show POST to `/api/upload/malware`
✅ **notice.log** will have EICAR detection alert
✅ **signatures.log** will show signature match  
✅ **files.log** will show the file transfer
✅ **conn.log** will show the connection

**See `attackers/malware_attacker/EICAR_DETECTION.md` for complete flow!**

---

## How to Generate These Logs

### Prerequisites
1. Zeek must be running (use `START.bat`)
2. Network traffic must exist for the specific protocols
3. The custom `local.zeek` configuration is loaded

### Testing Log Generation

**HTTP Traffic:**
```bash
curl http://example.com
```

**DNS Queries:**
```bash
nslookup google.com
```

**SSL/TLS:**
```bash
curl https://example.com
```

**SSH:**
```bash
ssh user@server
```

**FTP:**
```bash
ftp ftp.server.com
```

---

## Log Location

All logs are saved to:
```
Network_Security_poc/network/zeek_logs/session_YYYYMMDD_HHMMSS/
```

Each session folder contains logs for a 2-second capture window.

---

## Troubleshooting

### Log file not appearing?

1. **Check if traffic exists:** Zeek only creates log files when relevant traffic is detected
2. **Verify Zeek is running:** Check that `START.bat` shows active monitoring
3. **Check protocol detection:** Zeek uses dynamic protocol detection (DPD)
4. **Review conn.log:** This shows all connections, check if your traffic appears there

### Empty log files?

- The log file is created but no matching traffic was in that 2-second window
- Generate more traffic of that protocol type

### Only seeing conn.log?

- Your traffic may not be using standard protocols
- Check that the custom `local.zeek` script is being loaded
- Verify protocol analyzers are enabled in Zeek

---

## Configuration

The log files are controlled by `local.zeek` which loads:

```zeek
@load base/protocols/http
@load base/protocols/dns
@load base/protocols/ssl
@load base/protocols/ssh
@load base/protocols/ftp
```

This ensures all required protocol analyzers are active.

---

## Integration with MCP Agent

The MCP agent can query these logs to:
- Detect malicious HTTP requests
- Identify DNS tunneling
- Find expired SSL certificates
- Detect SSH brute force attempts
- Monitor unauthorized file transfers

Logs are in TSV (Tab-Separated Values) format for easy parsing.
