# Malware File Upload Attacker (Case 1 - Signature Detection)

## Overview
Sends **real malware APK files** over HTTP to test **signature-based detection** using hash matching against MalwareBazaar database. This attacker should be caught by **Case 1: Signature-based verification**.

## Architecture

```
Malware Container (192.168.6.200)
    │
    │ HTTP POST (Binary Transfer)
    │ Real APK File (5.5 MB)
    ▼
Network Monitor (192.168.6.131)
    │
    ├─► Zeek Capture & Extract
    ├─► Calculate SHA256 Hash  
    └─► Compare with MalwareBazaar DB
```

## Files

| File | Purpose |
|------|---------|
| `malware_simulator.sh` | Continuous malware behavior simulation |
| `send_malware_sample.py` | Send real APK file (Python) |
| `verify_hash.ps1` | Verify extracted file hash |
| `START.bat` | Start container |
| `SEND_SAMPLE.bat` | Send malware sample |
| `VERIFY_HASH.bat` | Verify hash extraction |
| `LOGS.bat` | View logs |
| `MALWARE_SAMPLE_GUIDE.md` | Complete guide |

## Malware Sample

**File**: `a864d996cb6607a470469d9192cfb8abd3797a8ad90bea7ce00caa1195b40e5f.apk`
- **SHA256**: `a864d996cb6607a470469d9192cfb8abd3797a8ad90bea7ce00caa1195b40e5f`
- **Size**: 5.5 MB
- **Type**: Android malware (APK)

## Quick Start

```cmd
# 1. Start container
START.bat

# 2. Send malware sample
SEND_SAMPLE.bat

# 3. Verify hash
VERIFY_HASH.bat

# 4. Check MalwareBazaar
cd ..\..\malware_db
CHECK_HASH.bat a864d996cb6607a470469d9192cfb8abd3797a8ad90bea7ce00caa1195b40e5f
```

## How It Works

1. **Binary Transfer**: APK sent via HTTP POST as raw binary
2. **Zeek Capture**: Monitors network, extracts files from HTTP
3. **Hash Calculation**: SHA256 of extracted file
4. **Verification**: Compare with original hash
5. **Detection**: Query MalwareBazaar database

## Expected Results

✅ **Hash Match**: `a864d996cb6607a470469d9192cfb8abd3797a8ad90bea7ce00caa1195b40e5f`  
✅ **File Size**: 5,501,723 bytes  
✅ **Detection**: MalwareBazaar identifies malware family  
✅ **Zeek Logs**: Complete HTTP capture with file extraction

## Detection Strategy: Case 1

This attacker focuses **ONLY on malware file uploads**:
- ✅ Uploads **real malware APK** files continuously
- ✅ Should be detected by **signature-based verification** (SHA256 hash matching)
- ✅ Hash should match MalwareBazaar database
- ❌ Does NOT perform behavioral attacks (see endpoint_behavior_attacker for Case 2)

## Comparison with Endpoint Behavior Attacker

| Feature | Malware File Attacker (Case 1) | Endpoint Behavior Attacker (Case 2) |
|---------|-------------------------------|-------------------------------------|
| **Detection Method** | Signature-based (hash matching) | Anomaly/Behavior-based |
| **File Type** | Real malware APK | Dummy files only |
| **Primary Activity** | File upload | Multiple behavioral patterns |
| **IP Address** | 192.168.6.200 | 192.168.6.201 |
| **Should be blocked by** | Hash database, YARA rules | Behavioral analysis |

## Troubleshooting

**Container not running?**
```cmd
docker ps -a
docker logs malware_attacker
```

**File not extracted?**
- Ensure Zeek is running: Check network monitor container
- Verify connectivity: `docker exec malware_attacker ping 192.168.6.131`
- Check server: `docker logs network-monitor`

**Hash mismatch?**
- Verify binary transfer (not multipart)
- Check file size: Should be exactly 5,501,723 bytes
- Ensure no compression

## Advanced

### Manual Send
```bash
docker exec malware_attacker python3 /app/send_malware_sample.py
```

### Real-time Logs
```bash
docker logs -f malware_attacker
```

### Container Shell
```bash
docker exec -it malware_attacker bash
```

## Documentation

- [MALWARE_SAMPLE_GUIDE.md](./MALWARE_SAMPLE_GUIDE.md) - Complete transfer & detection guide
- [MalwareBazaar Setup](../../malware_db/README.md) - Hash database configuration

## ⚠️ Security

**REAL MALWARE** - Use only in isolated test environments:
- Container is network-isolated
- File for hash detection testing only
- **Never execute the APK file**
- Delete after testing if not needed
