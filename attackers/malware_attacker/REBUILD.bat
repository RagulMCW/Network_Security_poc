@echo off
REM Rebuild malware attacker container with new APK sample

title Rebuild Malware Attacker

echo.
echo ================================================================
echo    REBUILD MALWARE ATTACKER CONTAINER
echo ================================================================
echo.
echo This will:
echo   1. Stop existing container
echo   2. Remove old container and image
echo   3. Rebuild with updated sample.apk
echo   4. Start new container
echo.

cd /d %~dp0

echo Stopping existing container...
wsl bash -c "docker stop malware_attacker 2>/dev/null || true"
echo.

echo Removing old container...
wsl bash -c "docker rm malware_attacker 2>/dev/null || true"
echo.

echo Removing old image...
wsl bash -c "docker rmi malware-attacker 2>/dev/null || true"
echo.

echo Building new image with sample.apk...
wsl bash -c "cd /mnt/e/Malware_detection_using_Aiagent/Network_Security_poc/attackers/malware_attacker && docker build -t malware-attacker ."
echo.

if %errorlevel% neq 0 (
    echo ✗ Build failed!
    pause
    exit /b 1
)

echo Starting new container...
wsl bash -c "cd /mnt/e/Malware_detection_using_Aiagent/Network_Security_poc/attackers/malware_attacker && docker-compose up -d"
echo.

echo ================================================================
echo ✓ REBUILD COMPLETE!
echo ================================================================
echo.
echo Container is now running with the real APK file
echo.
echo File: sample.apk
echo Hash: 945C9508137E5B5CC9FAEDC2A7C19F938968DE30ADB679BAA7D0B6A13E2B83B3
echo.
echo Next: Run SEND_SAMPLE.bat to transfer the file
echo ================================================================
echo.
pause
