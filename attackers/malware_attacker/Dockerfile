FROM ubuntu:22.04

RUN apt-get update && apt-get install -y \
    curl \
    dnsutils \
    uuid-runtime \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

RUN pip3 install requests

WORKDIR /app

# Copy scripts
COPY malware_simulator.sh /app/
COPY send_malware_sample.py /app/

# Copy the malware APK sample
COPY sample.apk /app/sample.apk

# Fix line endings (Windows CRLF to Unix LF) and make executable
RUN sed -i 's/\r$//' /app/malware_simulator.sh /app/send_malware_sample.py && \
    chmod +x /app/malware_simulator.sh /app/send_malware_sample.py

# Create logs directory
RUN mkdir -p /app/logs

CMD ["/app/malware_simulator.sh"]
