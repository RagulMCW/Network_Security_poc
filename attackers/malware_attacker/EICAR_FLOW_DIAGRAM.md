# EICAR Test Flow - Visual Guide

## ğŸ¯ Complete EICAR Detection Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    EICAR MALWARE TEST FLOW                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Step 1: Malware Container Sends EICAR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Malware Attacker Container        â”‚
â”‚  192.168.6.X                       â”‚
â”‚                                    â”‚
â”‚  malware_simulator_v2.sh           â”‚
â”‚  â†“                                 â”‚
â”‚  Every 40 seconds:                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EICAR_STRING =               â”‚ â”‚
â”‚  â”‚ X5O!P%@AP[4\PZX54(P^)7CC)7}$ â”‚ â”‚
â”‚  â”‚ EICAR-STANDARD-ANTIVIRUS-    â”‚ â”‚
â”‚  â”‚ TEST-FILE!$H+H*              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â”‚  Wraps in JSON:                    â”‚
â”‚  {                                 â”‚
â”‚    "content": "EICAR_STRING",      â”‚
â”‚    "filename": "malware.exe"       â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ curl -X POST
                 â”‚ http://192.168.6.131:5000/api/upload/malware
                 â”‚
                 â–¼
         Docker Network
         (custom_net bridge)
                 â”‚
                 â”‚ All traffic flows through
                 â”‚ br-xxxxxxxxxxxx interface
                 â”‚
                 â–¼

Step 2: Zeek Captures Traffic
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tcpdump on Docker Bridge         â”‚
â”‚                                    â”‚
â”‚  sudo tcpdump -i br-xxxx           â”‚
â”‚  â†“                                 â”‚
â”‚  Captures every 2 seconds          â”‚
â”‚  â†“                                 â”‚
â”‚  Saves: capture_20251119_143000.pcapâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ PCAP File Created
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Zeek Analyzer                     â”‚
â”‚  zeek -C -r capture.pcap           â”‚
â”‚       local.zeek                   â”‚
â”‚       eicar-signatures.sig         â”‚
â”‚                                    â”‚
â”‚  Loaded Analyzers:                 â”‚
â”‚  âœ“ HTTP Protocol Analyzer          â”‚
â”‚  âœ“ Signature Engine                â”‚
â”‚  âœ“ File Extraction                 â”‚
â”‚  âœ“ Notice Framework                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼

Step 3: Protocol Analysis
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Protocol Analyzer            â”‚
â”‚                                    â”‚
â”‚  Extracts:                         â”‚
â”‚  â”œâ”€ Method: POST                   â”‚
â”‚  â”œâ”€ URI: /api/upload/malware       â”‚
â”‚  â”œâ”€ Headers: User-Agent, etc.      â”‚
â”‚  â””â”€ Body: {"content":"EICAR..."}   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Triggers Event
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  http_entity_data EVENT            â”‚
â”‚                                    â”‚
â”‚  if (EICAR pattern in data) {      â”‚
â”‚    NOTICE: EICAR DETECTED!         â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼

Step 4: Signature Matching
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Signature Engine                  â”‚
â”‚                                    â”‚
â”‚  eicar-signatures.sig:             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ signature eicar-http-post {  â”‚ â”‚
â”‚  â”‚   http-request-body          â”‚ â”‚
â”‚  â”‚   /.*EICAR.*TEST-FILE.*/     â”‚ â”‚
â”‚  â”‚   event "EICAR in POST"      â”‚ â”‚
â”‚  â”‚ }                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â”‚  MATCH! âœ“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼

Step 5: Log Generation
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multiple Logs Created:            â”‚
â”‚                                    â”‚
â”‚  1. conn.log                       â”‚
â”‚     Connection details             â”‚
â”‚                                    â”‚
â”‚  2. http.log âœ“ CRITICAL            â”‚
â”‚     POST /api/upload/malware       â”‚
â”‚     User-Agent: EICAR-Uploader     â”‚
â”‚                                    â”‚
â”‚  3. notice.log âœ“âœ“ ALERT!           â”‚
â”‚     EICAR test string detected!    â”‚
â”‚     from X.X.X.X to Y.Y.Y.Y        â”‚
â”‚                                    â”‚
â”‚  4. signatures.log âœ“ MATCH         â”‚
â”‚     eicar-http-post matched        â”‚
â”‚                                    â”‚
â”‚  5. files.log                      â”‚
â”‚     File transfer recorded         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Auto-copy to Windows
                 â”‚
                 â–¼
         zeek_logs/session_*/
         â”œâ”€ conn.log
         â”œâ”€ http.log â† Check here!
         â”œâ”€ notice.log â† EICAR ALERT!
         â”œâ”€ signatures.log â† Match!
         â””â”€ files.log

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## ğŸ” Detailed Packet View

### What Malware Container Sends:

```http
POST /api/upload/malware HTTP/1.1
Host: 192.168.6.131:5000
User-Agent: EICAR-Uploader/malware
Content-Type: application/json
X-Malware-Upload: true
Content-Length: 150

{
  "type": "file_upload",
  "filename": "malware_sample_1_1732012345.exe",
  "content": "X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*",
  "size": 68
}
```

### What Zeek Extracts:

```
Connection:
  Source: 192.168.6.15:54321
  Dest:   192.168.6.131:5000
  Proto:  TCP

HTTP:
  Method:     POST
  URI:        /api/upload/malware
  User-Agent: EICAR-Uploader/malware
  
Body Content:
  "content": "X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            THIS TRIGGERS DETECTION!
```

### What Gets Logged:

```
http.log:
  ts=1732012345.123 | method=POST | uri=/api/upload/malware | user_agent=EICAR-Uploader/malware

notice.log:
  note=Signatures::Sensitive_Signature | msg=EICAR test string detected in HTTP traffic

signatures.log:
  sig_id=eicar-http-post | event=EICAR string in HTTP POST body
```

## ğŸ“Š Timeline View

```
Time    Component           Action
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
00:00   User                START.bat (malware_attacker)
00:01   Docker              Container starts
00:02   Malware Sim         Begins all behaviors
00:02   User                START.bat (zeek monitor)
00:03   tcpdump             Starts capturing on br-xxxx
00:04   Zeek Monitor        Processing loop begins

00:40   Malware Sim         ğŸ”´ First EICAR upload sent
00:40   Docker Network      Packet flows through bridge
00:40   tcpdump             Captures packet in PCAP
00:42   Zeek Analyzer       Processes PCAP (2s delay)
00:42   HTTP Analyzer       Extracts POST body
00:42   Event Handler       Detects EICAR pattern
00:42   Notice Framework    Generates alert
00:42   Signature Engine    Matches eicar-http-post
00:42   Log Writers         âœ… http.log created
                            âœ… notice.log created
                            âœ… signatures.log created
00:42   Auto-sync           Copies to Windows folder

01:20   Malware Sim         ğŸ”´ Second EICAR upload
01:22   Logs                âœ… Second detection logged

02:00   Malware Sim         ğŸ”´ Third EICAR upload
02:02   Logs                âœ… Third detection logged

...     Every 40s           Pattern continues
```

## ğŸ¯ Detection Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multiple Independent Detection Mechanisms              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. HTTP Protocol Detection                             â”‚
â”‚     â†“                                                   â”‚
â”‚     Event: http_entity_data                             â”‚
â”‚     Trigger: EICAR regex in body                        â”‚
â”‚     Output: notice.log entry                            â”‚
â”‚                                                         â”‚
â”‚  2. Signature Pattern Matching                          â”‚
â”‚     â†“                                                   â”‚
â”‚     Rule: eicar-http-post                               â”‚
â”‚     Trigger: HTTP POST body pattern                     â”‚
â”‚     Output: signatures.log entry                        â”‚
â”‚                                                         â”‚
â”‚  3. File Extraction                                     â”‚
â”‚     â†“                                                   â”‚
â”‚     Event: file_sniff                                   â”‚
â”‚     Trigger: HTTP file transfer                         â”‚
â”‚     Output: files.log entry                             â”‚
â”‚                                                         â”‚
â”‚  4. Connection Logging                                  â”‚
â”‚     â†“                                                   â”‚
â”‚     Always: All connections logged                      â”‚
â”‚     Output: conn.log entry                              â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… Verification Points

```
Step  Check                                 Expected Result
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1     docker ps | findstr malware          Container running

2     docker logs malware-attacker         [EICAR] Uploaded test file

3     wsl ps aux | findstr zeek_monitor    Process running

4     dir zeek_logs\session_*              Session folders exist

5     type zeek_logs\*\http.log            POST /api/upload/malware

6     type zeek_logs\*\notice.log          EICAR test string detected âœ“

7     type zeek_logs\*\signatures.log      eicar-http-post matched âœ“
```

## ğŸ“ Key Concepts

### Why This Works:

1. **Network Capture**
   - Docker containers share network bridge
   - All traffic goes through br-xxxx interface
   - tcpdump captures at kernel level
   - No traffic escapes

2. **Protocol Detection**
   - Zeek uses DPD (Dynamic Protocol Detection)
   - Identifies HTTP even on non-standard ports
   - Extracts full HTTP body
   - No encryption (plain HTTP)

3. **Pattern Matching**
   - EICAR string is unique and identifiable
   - Regex pattern matches exact string
   - Signatures add redundant detection
   - Multiple triggers = reliable detection

4. **Logging**
   - TSV format (Tab-Separated Values)
   - Human-readable
   - Machine-parseable
   - Timestamped and indexed

### What Makes EICAR Special:

```
Standard String: "Hello World"
  â†’ No special meaning
  â†’ Not detected

EICAR String: "X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
  â†’ Universally recognized test malware
  â†’ Triggers ALL security tools
  â†’ Safe (not real malware)
  â†’ Standard since 1991
```

## ğŸš€ Ready to Test!

**Your setup has:**
- âœ… Malware simulator with EICAR
- âœ… Zeek with EICAR detection
- âœ… Automatic logging
- âœ… Verification scripts
- âœ… Live monitoring
- âœ… Complete documentation

**Just run START.bat in both folders!**
