import os
import hashlib

TARGET_HASH = "945c9508137e5b5cc9faedc2a7c19f938968de30adb679baa7d0b6a13e2b83b3"
SEARCH_DIR = r"e:\Malware_detection_using_Aiagent\Network_Security_poc\network\zeek_logs\extracted_files"

def calculate_sha256(file_path):
    sha256_hash = hashlib.sha256()
    try:
        with open(file_path, "rb") as f:
            for byte_block in iter(lambda: f.read(4096), b""):
                sha256_hash.update(byte_block)
        return sha256_hash.hexdigest()
    except Exception as e:
        print(f"Error reading {file_path}: {e}")
        return None

def find_file_by_hash():
    print(f"Searching for hash: {TARGET_HASH}")
    print(f"In directory: {SEARCH_DIR}")
    
    if not os.path.exists(SEARCH_DIR):
        print(f"Directory not found: {SEARCH_DIR}")
        return

    count = 0
    found = False
    for root, dirs, files in os.walk(SEARCH_DIR):
        for file in files:
            file_path = os.path.join(root, file)
            file_hash = calculate_sha256(file_path)
            count += 1
            if file_hash == TARGET_HASH:
                print(f"MATCH FOUND!")
                print(f"File: {file}")
                print(f"Path: {file_path}")
                found = True
                break
        if found:
            break
    
    print(f"Scanned {count} files.")
    if not found:
        print("No match found.")

if __name__ == "__main__":
    find_file_by_hash()
