# Malware Database - Quick Reference

## ğŸš€ Setup (One-Time)
```bash
cd Network_Security_poc/malware_db
SETUP.bat
```

## ğŸ“‹ Daily Commands

### Check a File
```bash
CHECK_HASH.bat "path\to\file.exe"
```

### Update Databases
```bash
UPDATE_MALWAREBAZAAR.bat  # Daily
UPDATE_YARA_RULES.bat     # Weekly
```

### View Statistics
```bash
CHECK_HASH.bat --stats
```

## ğŸ¤– MCP Server Tools

### 1. Hash-Based Detection
```python
check_malware_hash(
    file_path="network/zeek_logs/.../extracted_file",
    check_online=False
)
```

**Use when:** File extracted from network traffic

### 2. Content-Based Detection
```python
scan_with_yara(
    file_path="network/zeek_logs/.../extracted_file",
    rule_name="all"  # or "eicar", "suspicious_http"
)
```

**Use when:** Hash check is clean but file is suspicious

## ğŸ¯ LLM Detection Workflow

```
1. User asks: "Check for malware"
   â†“
2. LLM calls: read_zeek_logs()
   â†“
3. Finds extracted files in files.log
   â†“
4. LLM calls: check_malware_hash(file_path)
   â†“
5. If MALWARE â†’ move_device_to_honeypot()
   â†“
6. If CLEAN but suspicious â†’ scan_with_yara()
   â†“
7. Report findings to user
```

## ğŸ“Š Database Sources

| Source | Type | Coverage | API |
|--------|------|----------|-----|
| **MalwareBazaar** | Hash | 1M+ samples | âœ… Free |
| **YARA Rules** | Pattern | 1000+ rules | âœ… GitHub |
| **EICAR** | Test | 3 signatures | âŒ Static |

## ğŸ”„ Update Schedule

- **MalwareBazaar**: Daily at 2 AM (Task Scheduler)
- **YARA Rules**: Weekly on Sunday at 3 AM
- **Custom Rules**: Manual as needed

## ğŸ§ª Test Commands

### EICAR Test
```bash
# Create test file
echo X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H* > eicar.txt

# Check it
CHECK_HASH.bat eicar.txt
```

Expected: `Threat Level: TEST_FILE`

## ğŸ†˜ Troubleshooting

| Problem | Solution |
|---------|----------|
| API rate limit | Wait 24h, use `--limit 1000` |
| YARA not installed | `pip install yara-python` |
| Hash not found | Try `--online` or YARA scan |
| Compilation errors | Run `UPDATE_YARA_RULES.bat` |

## ğŸ“ File Locations

```
malware_db/
â”œâ”€â”€ hash_databases/
â”‚   â”œâ”€â”€ malwarebazaar.txt     â† Hash database
â”‚   â”œâ”€â”€ eicar_test.txt        â† EICAR hashes
â”‚   â””â”€â”€ custom_malware.txt    â† Your additions
â”œâ”€â”€ yara_rules/
â”‚   â”œâ”€â”€ Yara-Rules/           â† GitHub rules
â”‚   â”œâ”€â”€ custom/               â† Your YARA rules
â”‚   â””â”€â”€ compiled_rules.yarc   â† Compiled (fast!)
â””â”€â”€ scripts/
    â”œâ”€â”€ check_hash.py         â† Standalone checker
    â”œâ”€â”€ update_malwarebazaar.py
    â””â”€â”€ update_yara_rules.py
```

## ğŸ’¡ Pro Tips

1. **Offline-first**: Local databases = no API limits
2. **Compile YARA**: 2-3x faster scans
3. **Custom rules**: Add organization-specific patterns
4. **Hash lookups**: <1ms (instant)
5. **YARA scans**: 10-100ms (still fast!)

## ğŸ”— Quick Links

- [Full Integration Guide](INTEGRATION_GUIDE.md)
- [MalwareBazaar](https://bazaar.abuse.ch/)
- [YARA Docs](https://yara.readthedocs.io/)
- [YARA Rules Repo](https://github.com/Yara-Rules/rules)
