<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Security Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Vis.js -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-shield-halved"></i>
                <span>Malware<span style="color: var(--primary)"></span>Detection</span>
            </div>
            <div class="nav-links">
                <button class="nav-btn active" onclick="showPage('overview', event)">
                    <i class="fas fa-chart-pie"></i> Overview
                </button>
                <button class="nav-btn" onclick="showPage('network-map', event)">
                    <i class="fas fa-project-diagram"></i> Map
                </button>
                <button class="nav-btn" onclick="showPage('monitor', event)">
                    <i class="fas fa-desktop"></i> Monitor
                </button>
                <button class="nav-btn" onclick="showPage('devices', event)">
                    <i class="fas fa-laptop"></i> Devices
                </button>
                <button class="nav-btn" onclick="showPage('beelzebub', event)">
                    <i class="fas fa-bug"></i> Honeypot
                </button>
                <button class="nav-btn" onclick="showPage('attackers', event)">
                    <i class="fas fa-skull"></i> Attackers
                </button>
                <button class="nav-btn" onclick="showPage('agent', event)">
                    <i class="fas fa-robot"></i> AI Agent
                </button>
                <button class="nav-btn" onclick="showPage('logs', event)">
                    <i class="fas fa-list-alt"></i> Logs
                </button>
                <button class="nav-btn danger" onclick="confirmStopAll()">
                    <i class="fas fa-power-off"></i> STOP ALL
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Overview Page -->
        <div id="page-overview" class="page active">
            <header style="margin-bottom: 2rem;">
                <h1>System Overview</h1>
                <p class="subtitle">Real-time monitoring of network security infrastructure</p>
            </header>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-containers">0</div>
                    <div class="stat-label">Running Containers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-devices">0</div>
                    <div class="stat-label">Active Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-registered">0</div>
                    <div class="stat-label">Registered Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-network">OFF</div>
                    <div class="stat-label">Network Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-monitor">OFF</div>
                    <div class="stat-label">Monitor Server</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-beelzebub">OFF</div>
                    <div class="stat-label">Beelzebub Status</div>
                </div>
            </div>

            <div class="grid">
                <!-- Network Control -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-network-wired text-info"></i> Network Control
                        </div>
                        <span class="status-badge" id="network-status">OFF</span>
                    </div>
                    <p class="text-muted" style="margin-bottom: 1rem;">
                        Docker network: <strong class="text-primary">custom_net (192.168.6.0/24)</strong>
                    </p>
                    <div class="controls">
                        <button class="btn btn-success" onclick="createNetwork()">
                            <i class="fas fa-plus-circle"></i> Create Network
                        </button>
                        <button class="btn btn-danger" onclick="deleteNetwork()">
                            <i class="fas fa-trash-alt"></i> Delete Network
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bolt text-warning"></i> Quick Actions
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="showPage('monitor')">
                            Monitor Server
                        </button>
                        <button class="btn btn-primary" onclick="showPage('devices')">
                            Manage Devices
                        </button>
                        <button class="btn btn-primary" onclick="showPage('beelzebub')">
                            View Beelzebub
                        </button>
                        <button class="btn btn-warning" onclick="refreshAll()">
                            <i class="fas fa-sync"></i> Refresh All
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Map Page -->
        <div id="page-network-map" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>Network Topology Map</h2>
                <p class="subtitle">Live visualization of all connected devices and containers</p>
            </header>

            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">Network: custom_net (192.168.6.0/24)</div>
                    <button class="btn btn-primary btn-small" onclick="refreshNetworkMap()">
                        <i class="fas fa-sync"></i> Refresh Map
                    </button>
                </div>
                <div style="text-align: center; padding: 0.5rem; color: var(--text-secondary);">
                    Gateway: <strong class="text-primary">192.168.6.1</strong> | 
                    Nodes: <strong id="map-node-count" class="text-info">0</strong> | 
                    Auto-refresh: <strong class="text-success">ON</strong>
                </div>
            </div>

            <!-- Network Visualization Canvas -->
            <div class="card" style="padding: 0; overflow: hidden;">
                <div id="network-map-container" style="height: 600px; background: #0f172a; position: relative;">
                    <svg id="network-svg" width="100%" height="600"></svg>
                </div>
            </div>

            <!-- Legend -->
            <div class="grid" style="margin-top: 1.5rem;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üé® Legend</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%;"></div>
                            <span>Main Gateway</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></div>
                            <span>Device (Main Net)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></div>
                            <span>Beelzebub</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #fb923c; border-radius: 50%;"></div>
                            <span>Beelzebub Network</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #fdba74; border-radius: 50%;"></div>
                            <span>Isolated Device</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #8b5cf6; border-radius: 50%;"></div>
                            <span>Monitor</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></div>
                            <span>Attacker</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Node Details</div>
                    </div>
                    <div id="node-details" style="max-height: 300px; overflow-y: auto;">
                        <p class="text-muted" style="text-align: center; padding: 1rem;">
                            Click on a node in the map to see details
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitor Server Page -->
        <div id="page-monitor" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>Network Monitor Server</h2>
                <p class="subtitle">Packet capture and network analysis server</p>
            </header>

            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-server text-primary"></i> Server Control
                        </div>
                        <span class="status-badge" id="monitor-status">OFF</span>
                    </div>
                    <div class="text-muted" style="margin-bottom: 1rem;">
                        <p><strong>Container:</strong> net-monitor-wan</p>
                        <p><strong>IP:</strong> 192.168.6.131:5000</p>
                        <p><strong>Role:</strong> Packet Capture & Device Management API</p>
                        <p><strong>HAProxy Stats:</strong> <a href="http://localhost:8415/stats" target="_blank" class="text-primary">localhost:8415</a></p>
                    </div>
                    <div class="controls">
                        <button class="btn btn-success" onclick="startMonitor()">
                            <i class="fas fa-play"></i> Start Server
                        </button>
                        <button class="btn btn-danger" onclick="stopMonitor()">
                            <i class="fas fa-stop"></i> Stop Server
                        </button>
                        <button class="btn btn-warning" onclick="refreshMonitorLogs()">
                            <i class="fas fa-sync"></i> Refresh Logs
                        </button>
                        <button class="btn btn-secondary" onclick="checkMonitorHealth()">
                            <i class="fas fa-heartbeat"></i> Health Check
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Server Information</div>
                    </div>
                    <div class="text-secondary">
                        <p style="margin-bottom: 0.5rem;"><strong>Purpose:</strong> Network packet capture and analysis</p>
                        <ul style="margin-left: 1.5rem; margin-bottom: 0.5rem;">
                            <li>Real-time packet capture (tcpdump)</li>
                            <li>HTTP/HTTPS traffic monitoring</li>
                            <li>Device tracking and registration</li>
                            <li>Load balancing (HAProxy)</li>
                            <li>REST API endpoints</li>
                        </ul>
                        <p><strong>Captures Location:</strong> <code class="font-mono">/captures</code></p>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">üìã Server Logs</div>
                    <button class="btn btn-primary btn-small" onclick="refreshMonitorLogs()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                <div class="logs-container" id="monitor-logs">
                    <div class="log-entry">Click "Refresh Logs" to load server logs...</div>
                </div>
            </div>
        </div>

        <!-- Devices Page -->
        <div id="page-devices" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>Device Management</h2>
                <p class="subtitle">Create and manage virtual network devices</p>
            </header>

            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">Add New Device</div>
                    <span class="status-badge status-off" id="device-count-badge">0 Devices</span>
                </div>
                <div class="input-group">
                    <select id="device-type">
                        <option value="generic">Generic Device</option>
                        <option value="iot_sensor">IoT Sensor</option>
                        <option value="smartphone">Smartphone</option>
                        <option value="laptop">Laptop</option>
                        <option value="camera">Camera</option>
                    </select>
                    <button class="btn btn-success" onclick="createDevice()">
                        <i class="fas fa-plus"></i> Create Device
                    </button>
                    <button class="btn btn-warning" onclick="refreshDevices()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" onclick="cleanupDevices()">
                        <i class="fas fa-broom"></i> Cleanup Stopped
                    </button>
                </div>
            </div>

            <div id="devices-container" class="device-grid"></div>
        </div>

        <!-- Beelzebub Page -->
        <div id="page-beelzebub" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>Beelzebub Honeypot</h2>
                <p class="subtitle">Intelligent honeypot for capturing and analyzing malicious traffic</p>
            </header>

            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bug text-warning"></i> Beelzebub Control
                        </div>
                        <span class="status-badge" id="beelzebub-status">OFF</span>
                    </div>
                    <div class="text-muted" style="margin-bottom: 1rem;">
                        <p><strong>Network:</strong> Dual-homed (honeypot_net + custom_net)</p>
                        <p><strong>IP:</strong> 192.168.7.2 (honeypot_net)</p>
                        <p><strong>Services:</strong> SSH, HTTP, MySQL, PostgreSQL, FTP, Telnet</p>
                    </div>
                    <div class="controls">
                        <button class="btn btn-success" onclick="startBeelzebub()">
                            Start Beelzebub
                        </button>
                        <button class="btn btn-danger" onclick="stopBeelzebub()">
                            Stop Beelzebub
                        </button>
                        <button class="btn btn-warning" onclick="refreshBeelzebubStats()">
                            Refresh Stats
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Active Services</div>
                        <span class="status-badge status-off" id="beelzebub-services-count">0 Services</span>
                    </div>
                    <div id="beelzebub-services" class="text-secondary" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <!-- Services will be populated by JavaScript -->
                        <div class="text-muted" style="grid-column: span 2; text-align: center;">Checking status...</div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">Interaction Statistics</div>
                    <span class="status-badge status-off" id="beelzebub-interactions">0 Interactions</span>
                </div>
                <div class="logs-container" id="beelzebub-logs">
                    <div class="log-entry">No attacker interactions logged yet</div>
                </div>
            </div>

            <!-- LLM AI Responses -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-brain text-primary"></i> LLM AI Responses
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-small" onclick="downloadLLMLogsAsHTML()">
                            <i class="fas fa-download"></i> Download HTML
                        </button>
                        <button class="btn btn-warning btn-small" onclick="refreshLLMLogs()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="logs-container" id="llm-logs" style="max-height: 500px; overflow-y: auto;">
                    <div class="log-entry">Loading LLM responses...</div>
                </div>
            </div>

            <!-- IP Reroute Feature -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-random text-info"></i> Reroute Device/Attacker to Honeypot
                    </div>
                    <span class="status-badge" id="reroute-count">0 Rerouted</span>
                </div>
                <div style="margin-bottom: 1rem;">
                    <p class="text-muted" style="margin-bottom: 1rem;">
                        Enter an IP address to redirect all its traffic to the honeypot network.
                    </p>
                    <div class="input-group">
                        <input type="text" id="reroute-ip" placeholder="Enter IP address (e.g., 192.168.6.50)">
                        <button class="btn btn-primary" onclick="rerouteIPToBeelzebub()">
                            <i class="fas fa-crosshairs"></i> Reroute to Beelzebub
                        </button>
                    </div>
                    <div class="text-muted" style="font-size: 0.85rem;">
                        <strong>üí° Tip:</strong> Find IP addresses in Network Map or Devices page.
                    </div>
                </div>
                
                <!-- Clear All DNAT Rules Button -->
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color);">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <div>
                            <h4 style="margin: 0; color: var(--danger-color);">
                                <i class="fas fa-broom"></i> Clear All DNAT Rules
                            </h4>
                            <p class="text-muted" style="font-size: 0.9rem; margin: 0.5rem 0 0 0;">
                                Remove ALL iptables DNAT rerouting rules for ALL devices. This will restore normal traffic for all rerouted devices.
                            </p>
                        </div>
                        <button class="btn btn-danger" onclick="clearAllDNATRules()" style="margin-left: 1rem;">
                            <i class="fas fa-eraser"></i> Clear All Rules
                        </button>
                    </div>
                    <div class="text-muted" style="font-size: 0.85rem; color: var(--warning-color);">
                        <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> This will flush all DNAT/FORWARD/POSTROUTING iptables chains and remove traffic rerouting for ALL devices.
                    </div>
                </div>

                <!-- Rerouted IPs List -->
                <div class="card-header" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div class="card-title">üö´ Devices Isolated in Honeypot</div>
                    <button class="btn btn-warning btn-small" onclick="refreshReroutes()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                <div id="rerouted-ips-list" style="margin-top: 1rem;">
                    <div class="text-muted" style="text-align: center; padding: 1rem;">No devices currently isolated in honeypot</div>
                </div>
            </div>

        </div>

        <!-- Attackers Page -->
        <div id="page-attackers" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>Attack Simulators</h2>
                <p class="subtitle">Simulate attacks for testing detection capabilities</p>
            </header>

            <!-- DOS Attacker -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-water text-info"></i> DOS Attacker (192.168.6.132)
                    </div>
                    <span class="status-badge" id="attacker-status">OFF</span>
                </div>
                <p class="text-muted" style="margin-bottom: 1rem;">
                    Simulates high-volume packet flooding (100+ packets/sec) to test DoS detection
                </p>
                <div class="controls">
                    <button class="btn btn-success" onclick="startAttackers()">
                        Start DOS Attacker
                    </button>
                    <button class="btn btn-danger" onclick="stopAttackers()">
                        Stop DOS Attacker
                    </button>
                </div>
            </div>

            <!-- SSH Attacker -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-lock-open text-danger"></i> SSH Brute Force Attacker (192.168.6.133)
                    </div>
                    <span class="status-badge" id="ssh-attacker-status">OFF</span>
                </div>
                <p class="text-muted" style="margin-bottom: 1rem;">
                    Simulates SSH brute force attacks against server (192.168.6.131:22) with common credentials
                </p>
                <div class="controls">
                    <button class="btn btn-success" onclick="startSSHAttacker()">
                        Start SSH Attacker
                    </button>
                    <button class="btn btn-danger" onclick="stopSSHAttacker()">
                        Stop SSH Attacker
                    </button>
                    <button class="btn btn-secondary" onclick="viewSSHLogs()">
                        View Logs
                    </button>
                </div>
                <div id="ssh-logs-container" style="display: none; margin-top: 1rem;">
                    <h4 class="text-muted" style="margin-bottom: 0.5rem;">SSH Attack Logs:</h4>
                    <pre id="ssh-logs-output" class="logs-container"></pre>
                </div>
            </div>

            <!-- Malware File Upload Attacker (Case 1) -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-file-code text-warning"></i> Malware File Attacker - Case 1 (192.168.6.200)
                    </div>
                    <span class="status-badge" id="malware-attacker-status">OFF</span>
                </div>
                <div class="text-muted" style="margin-bottom: 1rem;">
                    <p><strong>Detection Type:</strong> Signature-Based | <strong>IP:</strong> 192.168.6.200</p>
                    <p><strong>File Type:</strong> Real malware APK (5.5 MB)</p>
                    <p><strong>Activity:</strong> Continuous malware file uploads (every 5s)</p>
                </div>
                
                <!-- Behavior Status Grid -->
                <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div class="stat-card" style="padding: 1rem;">
                        <div class="text-muted" style="font-size: 0.8rem;">Malware Upload</div>
                        <div class="text-success" style="font-weight: bold;" id="malware-upload-status">Inactive</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-success" onclick="startMalwareAttacker()">
                        Start Malware Simulator
                    </button>
                    <button class="btn btn-danger" onclick="stopMalwareAttacker()">
                        Stop Malware Simulator
                    </button>
                    <button class="btn btn-secondary" onclick="viewMalwareLogs()">
                        View Logs
                    </button>
                    <button class="btn btn-secondary" onclick="checkMalwareStatus()">
                        Refresh Status
                    </button>
                </div>

                <!-- Malware Logs Container -->
                <div id="malware-logs-container" style="display: none; margin-top: 1rem;">
                    <h4 class="text-muted" style="margin-bottom: 0.5rem;">Malware Behavior Logs:</h4>
                    
                    <!-- Log Type Selector -->
                    <div style="margin-bottom: 0.5rem;">
                        <button class="btn btn-secondary btn-small" onclick="showMalwareLog('all')">All Logs</button>
                        <button class="btn btn-secondary btn-small" onclick="showMalwareLog('beacon')">C2 Beacon</button>
                        <button class="btn btn-secondary btn-small" onclick="showMalwareLog('exfil')">Exfiltration</button>
                        <button class="btn btn-secondary btn-small" onclick="showMalwareLog('eicar')">EICAR</button>
                        <button class="btn btn-secondary btn-small" onclick="showMalwareLog('dns')">DNS DGA</button>
                    </div>
                    
                    <div id="malware-log-all" class="malware-log-section">
                        <pre id="malware-logs-output" class="logs-container"></pre>
                    </div>
                    <div id="malware-log-beacon" class="malware-log-section" style="display: none;">
                        <pre id="malware-beacon-logs" class="logs-container text-success"></pre>
                    </div>
                    <div id="malware-log-exfil" class="malware-log-section" style="display: none;">
                        <pre id="malware-exfil-logs" class="logs-container text-warning"></pre>
                    </div>
                    <div id="malware-log-eicar" class="malware-log-section" style="display: none;">
                        <pre id="malware-eicar-logs" class="logs-container text-danger"></pre>
                    </div>
                    <div id="malware-log-dns" class="malware-log-section" style="display: none;">
                        <pre id="malware-dns-logs" class="logs-container text-info"></pre>
                    </div>
                </div>
            </div>

            <!-- Endpoint Behavior Attacker (Case 2) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-bullseye text-danger"></i> Endpoint Behavior Attacker - Case 2 (192.168.6.201)
                    </div>
                    <span class="status-badge" id="endpoint-behavior-attacker-status">OFF</span>
                </div>
                <div class="text-muted" style="margin-bottom: 1rem;">
                    <p><strong>Detection Type:</strong> Anomaly/Behavior-Based | <strong>IP:</strong> 192.168.6.201</p>
                    <p><strong>File Type:</strong> Dummy files (NO real malware)</p>
                    <p><strong>Behaviors:</strong> C2 Beacon, Data Exfil, DNS DGA, Port Scan, API Abuse, Credential Harvest, Privilege Escalation, Lateral Movement, Data Staging</p>
                </div>
                
                <!-- Behavior Status Grid -->
                <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">C2 Beacon</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-c2-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Data Exfil</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-exfil-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">DNS DGA</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-dns-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Port Scan</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-portscan-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">API Abuse</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-api-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Cred Harvest</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-cred-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Priv Escalation</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-priv-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Lateral Move</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-lateral-status">Inactive</div>
                    </div>
                    <div class="stat-card" style="padding: 0.5rem;">
                        <div class="text-muted" style="font-size: 0.7rem;">Data Staging</div>
                        <div class="text-success" style="font-weight: bold; font-size: 0.8rem;" id="endpoint-staging-status">Inactive</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-success" onclick="startEndpointBehaviorAttacker()">
                        Start Behavior Attacker
                    </button>
                    <button class="btn btn-danger" onclick="stopEndpointBehaviorAttacker()">
                        Stop Behavior Attacker
                    </button>
                    <button class="btn btn-secondary" onclick="viewEndpointBehaviorLogs()">
                        View Logs
                    </button>
                    <button class="btn btn-secondary" onclick="checkEndpointBehaviorStatus()">
                        Refresh Status
                    </button>
                </div>

                <!-- Endpoint Behavior Logs Container -->
                <div id="endpoint-behavior-logs-container" style="display: none; margin-top: 1rem;">
                    <h4 class="text-muted" style="margin-bottom: 0.5rem;">Endpoint Behavior Logs:</h4>
                    <pre id="endpoint-behavior-logs-output" class="logs-container"></pre>
                </div>
            </div>
        </div>

        <!-- AI Agent Page -->
        <div id="page-agent" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>AI Security Agent</h2>
                <p class="subtitle">Chat with AI to analyze network, manage devices, and detect threats</p>
            </header>

            <!-- Agent Status -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="agent-status-badge">
                        <span class="status-badge status-on">READY</span>
                    </div>
                    <div class="stat-label">MCP Agent Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="agent-tools-count">2</div>
                    <div class="stat-label">Autonomous Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="agent-queries-count">0</div>
                    <div class="stat-label">Queries Processed</div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="card" style="height: 700px; display: flex; flex-direction: column;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-comments text-primary"></i> Chat with AI Agent
                    </div>
                    <div>
                        <button class="btn btn-success btn-small" onclick="downloadChatHistory()">
                            <i class="fas fa-download"></i> Download Chat
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="clearAgentChat()">
                            <i class="fas fa-trash"></i> Clear Chat
                        </button>
                    </div>
                </div>
                
                <!-- Chat Messages Container -->
                <div id="agent-chat-messages" class="chat-messages">
                    <!-- Welcome Message -->
                    <div class="agent-message agent">
                        <div class="message-header">
                            <i class="fas fa-robot"></i>
                            <strong>AI Security Agent</strong>
                            <span class="message-time">Now</span>
                        </div>
                        <div class="message-content">
                            Professional AI agent for Docker network security monitoring and threat analysis.
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Analyze Zeek network traffic logs</li>
                                <li>Detect malware behaviors and attack patterns</li>
                                <li>Monitor Docker network (custom_net: 192.168.6.0/24)</li>
                                <li>Identify suspicious connections and anomalies</li>
                                <li>Generate security reports and recommendations</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-area">
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="agent-query-input" 
                            placeholder="Ask about network security... (e.g., 'analyze latest logs', 'check for threats')"
                            onkeypress="if(event.key === 'Enter') sendAgentQuery()"
                        />
                        <button class="btn btn-primary" onclick="sendAgentQuery()">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                    <!-- Quick Action Buttons -->
                    <div class="controls">
                        <button class="btn btn-primary btn-small" onclick="quickAgentQuery('read latest zeek logs and analyze')">
                            üîç Read Logs
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="quickAgentQuery('check docker network status')">
                            üê≥ Network Status
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="quickAgentQuery('analyze for malware and threats')">
                            üõ°Ô∏è Threat Check
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="quickAgentQuery('show docker containers')">
                            üì¶ Show Containers
                        </button>
                        <button class="btn btn-warning btn-small" onclick="quickAgentQuery('Analyze Zeek conn.log (last 100 lines) for network anomalies. IGNORE legitimate devices (IPs 192.168.6.2-192.168.6.10 sending to /api/device/data are authorized simulators). Focus on: unusual ports (not 5000/5100), high connection counts (DoS), external IPs, malware C2 patterns. Read attacks.jsonl for honeypot attacks. Summarize: 1) Real threats found 2) Honeypot attacks 3) Security status')">
                            üö® Quick Network Scan
                        </button>
                        <button class="btn btn-danger btn-small" onclick="quickAgentQuery('Full security audit: Analyze Zeek files.log for suspicious file transfers, scan unknown hashes using malware tools, read attacks.jsonl for attack patterns, check Docker containers. WHITELIST: IPs 192.168.6.2-192.168.6.10 are legitimate device simulators (ignore python-requests to /api/device/data). Report ONLY: verified malware, external attacks, C2 beaconing, unauthorized access, network health')">
                            üî• Full Security Audit
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Reroute Tool -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-route text-danger"></i> Quick Reroute to Beelzebub
                    </div>
                </div>
                <div style="padding: 1rem;">
                    <p class="text-muted" style="margin-bottom: 1rem;">
                        Quickly reroute a device to the isolated honeypot network for containment
                    </p>
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="quick-reroute-ip" 
                            placeholder="Enter device IP (e.g., 192.168.6.10)"
                        />
                        <button class="btn btn-danger" onclick="quickRerouteToBeelzebub()">
                            <i class="fas fa-exclamation-triangle"></i> Reroute Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="page">
            <header style="margin-bottom: 2rem;">
                <h2>System Logs</h2>
                <p class="subtitle">View logs from all components</p>
            </header>

            <!-- Tabs for different log types -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('device-data')">üì° Device Data</button>
                <button class="tab" onclick="switchTab('monitor-logs')">üñ•Ô∏è Monitor Server</button>
                <button class="tab" onclick="switchTab('beelzebub-logs')">üçØ Beelzebub Attacks</button>
                <button class="tab" onclick="switchTab('device-containers')">üê≥ Device Containers</button>
            </div>

            <!-- Device Data Tab -->
            <div id="tab-device-data" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üì° Live Device Data Stream</div>
                        <button class="btn btn-primary btn-small" onclick="refreshDeviceData()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <div class="data-table" id="device-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Device ID</th>
                                    <th>Type</th>
                                    <th>IP Address</th>
                                    <th>Sensor Data</th>
                                </tr>
                            </thead>
                            <tbody id="device-data-body">
                                <tr><td colspan="5" style="text-align: center; padding: 2rem;">No device data yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Monitor Logs Tab -->
            <div id="tab-monitor-logs" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üñ•Ô∏è Monitor Server Logs</div>
                        <button class="btn btn-primary btn-small" onclick="refreshMonitorLogsInTab()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <div class="logs-container" id="monitor-logs-tab">
                        <div class="log-entry">Click "Refresh" to load monitor server logs...</div>
                    </div>
                </div>
            </div>

            <!-- Honeypot Logs Tab -->
            <div id="tab-beelzebub-logs" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üçØ All Honeypot Logs (Unified View)</div>
                        <button class="btn btn-primary btn-small" onclick="viewBeelzebubLogsInTab()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <p class="text-muted" style="padding: 0 1rem; margin-bottom: 0.5rem;">
                        Showing all honeypot activity: SSH, HTTP, MySQL, PostgreSQL, FTP, Telnet
                    </p>
                    <div class="logs-container" id="beelzebub-logs-tab">
                        <div class="log-entry">Click "Refresh" to load all honeypot logs...</div>
                    </div>
                </div>
            </div>

            <!-- Device Container Logs Tab -->
            <div id="tab-device-containers" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üê≥ Device Container Logs</div>
                        <button class="btn btn-primary btn-small" onclick="refreshDeviceContainerLogs()">
                            <i class="fas fa-sync"></i> Refresh List
                        </button>
                    </div>
                    <p class="text-muted" style="margin-bottom: 1rem;">Select a device to view its container logs:</p>
                    <div id="device-container-list" style="margin-bottom: 1rem;">
                        <p class="text-muted">Loading devices...</p>
                    </div>
                    <div class="logs-container" id="device-container-logs">
                        <div class="log-entry">Select a device above to view its logs</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
